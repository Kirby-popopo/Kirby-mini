<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-stargram 회원가입</title>
    <link rel="stylesheet" href="/login/signup.css">
    <style>
        .error-message{
            display: none;
            color: red;
            margin-top: 10px;
        }

        .error-message.show {
            display: block;
            opacity: 1;
        }
        .input-container {
            position: relative;
            margin-bottom: 10px;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px 5px;
            font-size: 16px;
            box-sizing: border-box;
        }

        label {
            position: absolute;
            left: 10px;
            top: 12px;
            transition: all 0.3s ease;  /* 부드러운 전환 효과 */
            background-color: white;  /* 입력 필드 위에 있을 때 배경색을 설정 */
            padding: 0 5px;
            font-size: 16px;
            color: gray;
        }

        /* 입력 필드가 포커스를 받거나 입력 값이 있을 때 라벨을 위로 이동 */
        input:focus + label,
        input:not(:placeholder-shown) + label {
            top: -10px;  /* 라벨을 위로 이동 */
            font-size: 12px;  /* 글자 크기 줄이기 */
            color: #007BFF;  /* 포커스 상태에서 색상 변경 */
        }

        .gender-container {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
        }

        .gender-container label {
            display: flex;
            align-items: center;
            cursor: pointer;
            position: relative;
        }

        input[type="radio"] {
            display: none;  /* 기본 라디오 버튼 숨기기 */
        }

        .custom-radio {
            width: 16px;
            height: 16px;
            border: 2px solid #007BFF; /* 라디오 버튼 외곽선 */
            border-radius: 50%;  /* 둥근 모양 */
            margin-right: 10px;  /* 라벨과 간격 조정 */
            position: relative;
        }

        input[type="radio"]:checked + .custom-radio {
            background-color: #007BFF;  /* 체크된 경우 배경색 */
            border-color: #007BFF;
        }

        input[type="radio"]:checked + .custom-radio::after {
            content: "";
            width: 8px;
            height: 8px;
            background-color: white;  /* 내부 점 색상 */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
        }
        .inputID {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

        .check-button {
            font-size: 14px;
            height : 35px;
            width: 100px;
            cursor: pointer;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
            margin-bottom: 20px;
        }

        .check-button:hover {
            background-color: #0056b3;
        }

        #password {
            flex: 1;
            padding: 10px 5px;
            font-size: 16px;
            box-sizing: border-box;
            margin: 0; /* 불필요한 마진 제거 */
        }
        /* 사용자 ID가 유효한 경우 */
        #userid.valid {
            border: 2px solid #28a745;  /* 초록색 외곽선으로 표시 */
        }

    </style>
</head>
<body>
<div class="signup-container">
    <div class="logo">K-stargram</div>
    <div class="subtitle">친구들의 사진과 동영상을 보려면 가입하세요.</div>
    <form id="signupForm" action="/signup/join" method="post">

        <!--번호 또는 이메일-->
        <div class="input-container">
            <input type="text" id="UserInput" name="UserInput" placeholder="" required>
            <label for="UserInput">휴대폰 번호 또는 이메일 주소</label>
            <div id="userError" class="error-message"></div>
        </div>
        <input type="hidden" id="phoneNumber" name="phoneNumber">
        <input type="hidden" id="email" name="email">

        <!--사용자 ID 및 중복 체크-->
        <div class="input-container">
            <div class="inputID">
            <input type="text" id="userid" name="userId" placeholder="" required>
            <label for="userid">사용자 ID</label>
            </div>
            <div id="usernameError" class="error-message"></div>
        </div>

        <!--사용자 이름-->
        <div class="input-container">
            <input type="text" id="name" name="name" placeholder="" required>
            <label for="name">이름</label>
        </div>

        <!--성별-->
        <div class="gender-container">
            <label for="male">
                <input type="radio" id="male" name="gender" value="M" required>
                <span class="custom-radio"></span> 남성
            </label>
            <label for="female">
                <input type="radio" id="female" name="gender" value="F" required>
                <span class="custom-radio"></span> 여성
            </label>
        </div>

        <!--별명-->
        <div class="input-container">
            <input type="text" id="nickname" name="nickname" placeholder="" required>
            <label for="nickname">별명</label>
        </div>

        <div id="emailError" class="error"></div>
        <div id="usernameSuggestions" class="username-suggestions"></div>

        <div class="password-container">
            <input type="password" id="password" name="userPw" placeholder="비밀번호" required>
            <button type="button" id="passwordToggle" class="password-toggle">표시</button>
        </div>
        <div id="passwordError" class="error"></div>

        <button type="submit" id="submitButton">가입</button>
    </form>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    const userInputField = document.getElementById('UserInput');
    const emailField = document.getElementById('email');
    const phoneNumberField = document.getElementById('phoneNumber');
    const password = document.getElementById('password');
    const passwordToggle = document.getElementById('passwordToggle');
    const userError = document.getElementById('userError');
    const usernameError = document.getElementById('usernameError');
    const passwordError = document.getElementById('passwordError');
    const checkUserID = document.getElementById('checkUserID');
    const useridInput = document.getElementById('userid');
    const style = document.createElement('style');

    // 입력 필드에서 입력이 발생할 때마다 유효성 검사 수행
    userInputField.addEventListener('input', validateUserInput);
    userInputField.addEventListener('blur', validateUserInput);

    passwordToggle.addEventListener('click', function() {
        if (password.type === 'password') {
            password.type = 'text';
            passwordToggle.textContent = '숨기기';
        } else {
            password.type = 'password';
            passwordToggle.textContent = '표시';
        }
    });

    document.getElementById('submitButton').addEventListener('click', function(event) {
        // 사용자 ID 입력 확인
        if (userid.value.trim() === '') {
            alert('사용자 ID를 입력해 주세요.');
            event.preventDefault(); // 폼 제출 X
            return;
        }

        // 사용자 ID 중복 확인 결과 확인
        if (usernameError.classList.contains('show')) {
            alert('이미 사용 중인 사용자 ID입니다. 다른 ID를 선택해 주세요.');
            event.preventDefault(); // 폼 제출 X
            return;
        }

        // 비밀번호 유효성 검사
        if (password.value.trim().length < 6) {
            alert('비밀번호는 6자 이상이어야 합니다.');
            event.preventDefault(); // 폼 제출 X
            return;
        }
        // 모든 조건이 충족된 경우 폼 제출이 가능
    });


    useridInput.addEventListener('input', function() {
        // 사용자가 아무 것도 입력하지 않았을 때는 확인하지 않음
        if (useridInput.value.trim() === '') {
            usernameError.textContent = '';
            usernameError.classList.remove('show');
            return;
        }

        // AJAX 요청으로 서버에 중복 체크 요청
        $.ajax({
            type: 'POST',
            url: '/signup/checkId',
            data: { userId: useridInput.value.trim() },
            success: function(isDuplicate) {
                if (isDuplicate) {
                    // 중복된 사용자 ID가 있을 경우
                    usernameError.textContent = '이미 사용 중인 사용자 ID입니다. 다른 ID를 선택해 주세요.';
                    usernameError.classList.add('show');
                    useridInput.classList.remove('valid'); // 테두리 표시 제거
                } else {
                    // 중복되지 않은 경우
                    usernameError.textContent = '';
                    usernameError.classList.remove('show');
                    useridInput.classList.add('valid'); // 테두리 표시 추가
                }
            },
            error: function() {
                alert('서버와의 통신에 실패했습니다. 다시 시도해 주세요.');
            }
        });
    });

    function validateUserInput() {
        const userInput = userInputField.value;
        const phoneRegex = /^(\+?\d{1,3})?[-.\s]?\(?\d{1,4}?\)?[-.\s]?\d{1,4}[-.\s]?\d{1,9}$/;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        if (phoneRegex.test(userInput)) {
            // 입력이 전화번호 형식일 때
            phoneNumberField.value = userInput;
            emailField.value = '';  // 이메일 값 초기화
            userError.textContent = '';
            userError.classList.remove('show');
        } else if (emailRegex.test(userInput)) {
            // 입력이 이메일 형식일 때
            emailField.value = userInput;
            phoneNumberField.value = '';  // 전화번호 값 초기화
            userError.textContent = '';
            userError.classList.remove('show');
        } else {
            // 올바르지 않은 형식일 때
            userError.textContent = '유효한 휴대폰 번호 또는 이메일 주소를 입력하세요.';
            userError.classList.add('show');
            phoneNumberField.value = '';
            emailField.value = '';
        }
    }

    //비밀번호 유효성
    password.addEventListener('input', function() {
        if (password.value.trim().length < 6) {
            passwordError.textContent = '비밀번호는 6자 이상이어야 합니다.';
        } else {
            passwordError.textContent = '';
        }
    });

</script>
</body>
</html>